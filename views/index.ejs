<!-- Task Dashboard Main Page â€” by Kyal -->
<!DOCTYPE html>
<html lang="en">

<head>
  <!-- Meta & Page Setup â€” by Kyal -->
  <meta charset="UTF-8">
  <title>Task Dashboard</title>

  <!-- External Stylesheet â€” by Kyal -->
  <link rel="stylesheet" href="/style.css">

  <!-- Glassmorphism + Neon UI Enhancements â€” by Kyal -->
  <style>
    @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600;700&display=swap');

    /* Base Page Styling â€” by Kyal */
    body {
      font-family: 'JetBrains Mono', monospace;
      background: linear-gradient(135deg, #fce4ec, #e8f5e9);
    }

    /* Glass Card Base Styling â€” by Kyal */
    .glass-card {
      background: rgba(255, 255, 255, 0.45);
      backdrop-filter: blur(14px);
      border: 1px solid rgba(255, 255, 255, 0.4);
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
      border-radius: 12px;
      transition: all 0.3s ease;
    }

    /* Glass Card Hover Effect â€” by Kyal */
    .glass-card:hover {
      transform: translateY(-6px);
      border-color: #f92068;
      box-shadow: 0 20px 45px rgba(233, 30, 99, 0.25);
    }

    /* Primary Buttons Styling â€” by Kyal */
    .btn,
    .nav-add {
      background: linear-gradient(45deg, #a3f8a6, #f191b1);
      color: white;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 1px;
      border: none;
      padding: 12px 22px;
      transition: all 0.3s ease;
    }

    .btn:hover,
    .nav-add:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(232, 51, 111, 0.4);
    }

    /* Action Buttons Styling â€” by Kyal */
    .edit {
      border: 2px solid #4caf50;
      padding: 6px 12px;
      color: #4caf50;
      transition: all 0.3s ease;
    }

    .edit:hover {
      background: #4caf50;
      color: white;
    }

    .delete {
      border: 2px solid #e53935;
      padding: 6px 12px;
      color: #e53935;
      transition: all 0.3s ease;
    }

    .delete:hover {
      background: #e53935;
      color: white;
    }

    /* Bottom Navigation Styling â€” by Kyal */
    .navbar a {
      border: 2px solid transparent;
      transition: all 0.3s ease;
    }

    .navbar a:hover {
      border-color: #e91e63;
      background: rgba(233, 30, 99, 0.15);
    }

    /* Carousel Section Styling â€” by Kyal */
    .task-carousel {
      margin: 30px 0;
    }

    .carousel-card {
      height: 200px;
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
    }
  </style>
</head>

<body>

  <!-- Search & Filter Form â€” by Kyal -->
  <form action="/" method="GET" class="task-search-form">
    <input type="text" name="search" placeholder="Search tasks..."
      value="<%= typeof search !== 'undefined' ? search : '' %>">

    <select name="priority">
      <option value="">All Priorities</option>
      <option value="High" <%= priority==='High' ? 'selected' : '' %>>High</option>
      <option value="Medium" <%= priority==='Medium' ? 'selected' : '' %>>Medium</option>
      <option value="Low" <%= priority==='Low' ? 'selected' : '' %>>Low</option>
    </select>

    <input type="date" name="dueDate" value="<%= typeof dueDate !== 'undefined' ? dueDate : '' %>">

    <button type="submit">Filter</button>
  </form>

  <!-- Task Carousel Section with Text Only â€” by Kyal -->
  <div class="task-carousel">
    <div class="glass-card carousel-card" style="position: relative; overflow: hidden;">
      <img
        src="https://images.unsplash.com/photo-1422205512921-12dac7b3b603?fm=jpg&q=60&w=3000&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxzZWFyY2h8MTF8fHdhbGxwYXBlciUyMHNwcmluZ3xlbnwwfHwwfHx8MA%3D%3D"
        alt="Task Image"
        style="width: 100%; height: 200px; object-fit: cover; display: block;">

      <!-- Plain text overlay -->
      <h2 style="
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        color: white;
        margin: 0;
      ">ðŸ“‹ My Tasks</h2>
    </div>
  </div>

  <!-- Main Task Table Wrapper â€” by Kyal -->
  <div class="glass-card">

    <!-- Main Content Area â€” by Kyal -->
    <main>
      <% if (tasks.length === 0) { %>
        <p>No tasks yet. Add one!</p>
      <% } else { %>

        <!-- Task Table â€” by Kyal -->
        <table>
          <thead>
            <tr>
              <th>Task</th>
              <th>Priority</th>
              <th>Due Date</th>
              <th>Actions</th>
              <th>Done</th>
            </tr>
          </thead>

          <tbody>
            <% tasks.forEach(task => { %>
              <tr class="<%= task.priority.toLowerCase() %>">
                <td><%= task.name %></td>
                <td><%= task.priority %></td>
                <td><%= task.due %></td>

                <!-- Edit / Delete Actions â€” by Kyal -->
                <td>
                  <a class="edit" href="/edit/<%= task.id %>">Edit</a>
                  <a class="delete" href="/delete/<%= task.id %>">Delete</a>
                </td>

                <!-- Completion Checkbox â€” by Alicia -->
                <td>
                  <div class="custom-checkbox data-id="<%= task.id %>"
                       data-completed="<%= task.completed ? 'true' : 'false' %>">
                    <% if (task.completed) { %>
                      <span class="tick">âœ“</span>
                    <% } %>
                  </div>
                </td>
              </tr>
            <% }); %>
          </tbody>
        </table>

      <% } %>
    </main>

  </div>

  <!-- Bottom Navigation Bar â€” by Kyal -->
  <nav class="navbar">
    <a href="/calendar" class="nav-item">ðŸ—“ Calendar</a>
    <a href="/add" class="nav-add">+</a>
    <a href="/" class="nav-item active">ðŸ“‹ Tasks</a>
  </nav>

  <!-- Task Completion Confirmation Modal â€” by Alicia -->
  <div id="taskCompletionModal" class="modal-overlay">
    <div class="modal-content">
      <h3>Task Completed! ðŸŽ‰</h3>
      <p>Do you want to delete the task?</p>
      <div class="modal-buttons">
        <button id="confirmDeleteBtn" class="modal-btn delete-btn">Delete</button>
        <button id="confirmKeepBtn" class="modal-btn keep-btn">Keep</button>
      </div>
    </div>
  </div>

  <!-- Hidden JSON data  â€” by Kyal -->
  <div id="task-data" style="display:none"><%- JSON.stringify(tasks) %></div>

  <!-- Script (Modal + Complete logic) â€” Alicia -->
  <script>
    let activeTaskId = null;

    function handleTaskCheck(taskId, isCompleted) {
      if (!isCompleted) {
        activeTaskId = taskId;
        document.getElementById('taskCompletionModal').style.display = 'flex';
      } else {
        window.location.href = '/complete/' + taskId;
      }
    }

    document.getElementById('confirmDeleteBtn').onclick = function () {
      window.location.href = '/delete/' + activeTaskId;
    };

    document.getElementById('confirmKeepBtn').onclick = function () {
      window.location.href = '/complete/' + activeTaskId;
      document.getElementById('taskCompletionModal').style.display = 'none';
    };
  </script>

  <div id="dueReminderPopup" class="due-notification-box">
    <span id="reminderText"></span>
  </div>

  <!-- Alicia's pop-up notification -->
  <script>
    function closeReminderAlicia() {
      const popup = document.getElementById('dueReminderPopup');
      if (popup) {
        popup.style.opacity = '0';
        setTimeout(() => { popup.style.display = 'none'; }, 500);
      }
    }

    (function () {
      const today = new Date();
      today.setHours(0, 0, 0, 0);

      // Read tasks safely from hidden JSON block
      const tasksFromBackend = JSON.parse(document.getElementById('task-data').textContent);

      const overdueTasks = tasksFromBackend.filter(t => {
        if (t.completed) return false;
        const taskDueDate = new Date(t.due);
        taskDueDate.setHours(0, 0, 0, 0);
        return taskDueDate < today;
      });

      if (overdueTasks.length > 0) {
        const popup = document.getElementById('dueReminderPopup');
        const textSpan = document.getElementById('reminderText');

        const taskNames = overdueTasks.map(t => t.name).join(", ");
        textSpan.innerText = "Reminder: " + taskNames + " is incomplete, get it done soon!";
        popup.style.display = 'block';
        popup.style.opacity = '1';

        setTimeout(() => {
          if (popup.style.display !== 'none') closeReminderAlicia();
        }, 45000);
      }
    })();
  </script>

</body>
</html>
